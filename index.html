<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hexbin Map</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://d3js.org/d3-hexbin.v0.2.2/d3-hexbin.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #hexbin {
            width: 100%;
            height: 600px; /* Adjust as needed */
        }
        .tooltip {
            position: absolute;
            text-align: center;
            padding: 5px;
            font: 12px sans-serif;
            background: lightsteelblue;
            border: 1px solid #333;
            border-radius: 5px;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <h1>Hexbin Map of Column A</h1>
    <div id="hexbin"></div>
    <div class="tooltip" style="opacity: 0;"></div>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Load data from Flask server
            d3.json('/data').then(function(data) {
                console.log(data); // Debug data

                if (!data || data.length === 0) {
                    console.error('No data received or data is empty');
                    return;
                }

                const width = 960;
                const height = 600;
                const hexRadius = 20;
                const tooltip = d3.select(".tooltip");

                const svg = d3.select("#hexbin").append("svg")
                    .attr("width", width)
                    .attr("height", height);

                const hexbin = d3.hexbin()
                    .radius(hexRadius)
                    .x(d => d.x)
                    .y(d => d.y);

                const color = d3.scaleSequential(d3.interpolateBlues)
                    .domain([0, d3.max(data, d => d.count)]);

                svg.selectAll("path")
                    .data(hexbin(data))
                    .enter().append("path")
                    .attr("d", d => `M${d.x},${d.y}${hexbin.hexagon()}`)
                    .style("fill", d => color(d.length))
                    .style("stroke", "#fff")
                    .style("stroke-width", "1px")
                    .on("mouseover", function(event, d) {
                        tooltip.transition().duration(200).style("opacity", .9);
                        tooltip.html(d.data.A + "<br/>Count: " + d.length)
                            .style("left", (event.pageX + 5) + "px")
                            .style("top", (event.pageY - 28) + "px");
                    })
                    .on("mouseout", function(d) {
                        tooltip.transition().duration(500).style("opacity", 0);
                    });
            }).catch(function(error) {
                console.error('Error fetching data:', error);
            });
        });
    </script>
</body>
</html>